
  <meta charset="UTF-8">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.ckeditor.com/ckeditor5/41.1.0/classic/ckeditor.js"></script>

 

{% extends "base.html" %}

{% block title %}{{ post.title }}{% endblock %}
{% block body_class %}{{ 'photo-background' if is_gallery_category else '' }}{% endblock %}

{% block content %}


  <div class="qa-write">
    <h2>âœï¸ ê¸€ ìˆ˜ì •</h2>

    <form method="POST" action="{{ url_for('post.edit', post_id=post.id) }}">
      <label for="title">ì œëª©</label>
      <input type="text" name="title" id="title" value="{{ post.title }}" required>

      <label for="author">ì‘ì„±ì</label>
      <input type="text" name="author" id="author" value="{{ post.author }}" required>

      <label for="content">ë‚´ìš©</label>
      <textarea name="content" id="editor">{{ post.content|safe }}</textarea>

      <button type="submit" class="btn">ìˆ˜ì • ì™„ë£Œ</button>
    </form>

    <div class="action-back">
      <a href="{{ url_for('post.detail', post_id=post.id) }}">â† ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <script>
  let editorInstance;

  ClassicEditor
  .create(document.querySelector('#editor'), {
    ckfinder: {
      uploadUrl: "{{ url_for('post.upload_image') }}"
    }
  })

    .then(editor => {
      editorInstance = editor;

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
      editor.plugins.get('FileRepository').createUploadAdapter = (loader) => {
        return {
          upload: () => {
            return new Promise((resolve, reject) => {
              const data = new FormData();
              loader.file.then(file => {
                data.append('upload', file);
                fetch("{{ url_for('post.upload_image') }}", {
                  method: 'POST',
                  body: data
                })
                .then(response => response.json())
                .then(result => {
                  if (result.url) {
                    resolve({ default: result.url });
                  } else {
                    reject(result.error?.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
                  }
                })
                .catch(() => reject('ì„œë²„ì™€ í†µì‹  ì˜¤ë¥˜'));
              });
            });
          }
        };
      };

      // ê¸€ ì €ì¥ ì‹œ ì—ë””í„° ë‚´ìš© ë°˜ì˜
      document.querySelector('form').addEventListener('submit', (e) => {
        const content = editorInstance.getData().trim();
        if (!content) {
          alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
          e.preventDefault();
          return;
        }
        document.querySelector('#editor').value = content;
      });
    })
    .catch(error => console.error("ğŸ›‘ CKEditor ì´ˆê¸°í™” ì‹¤íŒ¨:", error));
</script>

{% endblock %}