{% extends "base.html" %}

{% block title %}ğŸ›¡ ê´€ë¦¬ì í˜ì´ì§€{% endblock %}

{% block head_scripts %}
<style>
  h2, h3 { margin-top: 2rem; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }
  th, td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: center;
  }
  th {
    background-color: #f0f0f0;
  }
  a { text-decoration: none; color: #333; }
  .btn-delete {
    padding: 6px 12px;
    background-color: #cc4444;
    color: white;
    border: none;
    cursor: pointer;
    margin-bottom: 2rem;
  }
  .btn-delete:hover {
    background-color: #a33;
  }
  .back-link {
    margin-top: 3rem;
    display: inline-block;
  }
  .admin-actions {
    margin-bottom: 1rem;
  }
  .admin-actions a {
    margin-right: 1rem;
    font-weight: bold;
    color: #007bff;
  }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
  <h2>ğŸ›¡ ê´€ë¦¬ì ì „ìš© í˜ì´ì§€</h2>

  <div class="admin-actions">
    <a href="{{ url_for('admin.change_password') }}">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
    <a href="{{ url_for('post.index', category='ììœ ê²Œì‹œíŒ', page=1) }}">ğŸ“ ê²Œì‹œíŒ ë³´ê¸°</a>
    <a href="{{ url_for('home') }}">ğŸ  í™ˆìœ¼ë¡œ</a>
  </div>

  <!-- ğŸ“‚ ê²Œì‹œíŒ í•„í„° -->
  <form method="get" style="margin-bottom: 1rem;">
    <label>ğŸ“‚ ê²Œì‹œíŒ ì„ íƒ:</label>
    <select name="category" onchange="this.form.submit()">
      <option value="ì „ì²´" {% if selected_category == 'ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
      {% for cat in categories %}
        <option value="{{ cat.name }}" {% if selected_category == cat.name %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
  </form>

  <h3>ğŸ“‚ {{ selected_category }} {% if selected_category != 'ì „ì²´' %}ê²Œì‹œíŒ{% endif %}</h3>

  <!-- ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡ -->
  <form method="post" action="{{ url_for('post.bulk_delete') }}">
    <table>
      <thead>
        <tr>
          <th><input type="checkbox" onclick="toggleAll(this, 'post_ids')"></th>
          <th>ID</th>
          <th>ì œëª©</th>
          <th>ì‘ì„±ì</th>
          <th>ì‘ì„±ì¼</th>
        </tr>
      </thead>
      <tbody>
        {% for post in posts %}
        <tr>
          <td><input type="checkbox" name="post_ids" value="{{ post.id }}" class="post_ids"></td>
          <td>{{ post.id }}</td>
          <td><a href="{{ url_for('post.detail', post_id=post.id) }}">{{ post.title }}</a></td>
          <td>{{ post.author }}</td>
          <td>{{ post.date }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit" class="btn-delete" onclick="return confirm('ì„ íƒí•œ ê²Œì‹œê¸€ì„ ì‚­ì œí• ê¹Œìš”?')">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
  </form>

  <hr>

  <!-- ğŸ’¬ ëŒ“ê¸€ ê´€ë¦¬ -->
  <section>
    <h3>ğŸ’¬ ëŒ“ê¸€ ê´€ë¦¬</h3>
    <form method="post" action="{{ url_for('post.bulk_delete_comment') }}">
      <table>
        <thead>
          <tr>
            <th><input type="checkbox" onclick="toggleAll(this, 'comment_ids')"></th>
            <th>ID</th>
            <th>ê¸€ID</th>
            <th>ì‘ì„±ì</th>
            <th>ë‚´ìš©</th>
          </tr>
        </thead>
        <tbody>
          {% for c in comments %}
          <tr>
            <td><input type="checkbox" name="comment_ids" value="{{ c.id }}" class="comment_ids"></td>
            <td>{{ c.id }}</td>
            <td>{{ c.post_id }}</td>
            <td>{{ c.author }}</td>
            <td style="text-align:left;">{{ c.content[:40] }}{% if c.content|length > 40 %}...{% endif %}</td>
          </tr>
          {% else %}
          <tr><td colspan="5">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit" class="btn-delete" onclick="return confirm('ì„ íƒí•œ ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?')">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>
    </form>
  </section>

  <br>
  <a href="{{ url_for('post.index', category='ììœ ê²Œì‹œíŒ', page=1) }}" class="back-link">â† ê²Œì‹œíŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

  <!-- â• ê²Œì‹œíŒ ì¶”ê°€ -->
  <h3>â• ê²Œì‹œíŒ ì¶”ê°€</h3>
  <form method="post" action="{{ url_for('admin.add_category') }}">
    <input type="text" name="category_name" placeholder="ìƒˆ ê²Œì‹œíŒ ì´ë¦„" required />
    <select name="category_type" required>
      <option value="text">ì¼ë°˜ ê²Œì‹œíŒ</option>
      <option value="photo">ì‚¬ì§„ ê²Œì‹œíŒ</option>
    </select>
    <button type="submit">ì¶”ê°€</button>
  </form>

  <!-- â– ê²Œì‹œíŒ ì‚­ì œ -->
  <h3>â– ê²Œì‹œíŒ ì‚­ì œ</h3>
  <form method="post" action="{{ url_for('admin.delete_category') }}">
    <select name="category_id" required>
      {% for c in categories %}
        <option value="{{ c.id }}">{{ c.name }}</option>
      {% endfor %}
    </select>
    <button type="submit" onclick="return confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
  </form>

  <!-- ğŸ›  ê²Œì‹œíŒ íƒ€ì… ìˆ˜ì • -->
  <h3>ğŸ›  ê²Œì‹œíŒ íƒ€ì… ìˆ˜ì •</h3>
  <form method="post" action="{{ url_for('admin.edit_category') }}">
    <select name="category_id" required>
      {% for c in categories %}
        <option value="{{ c.id }}">{{ c.name }}</option>
      {% endfor %}
    </select>
    <select name="category_type" required>
      <option value="text">ğŸ“ ì¼ë°˜</option>
      <option value="photo">ğŸ“· ì‚¬ì§„</option>
    </select>
    <button type="submit">ìˆ˜ì •</button>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  function toggleAll(source, className) {
    const checkboxes = document.querySelectorAll('input.' + className);
    checkboxes.forEach(cb => cb.checked = source.checked);
  }

  document.addEventListener('DOMContentLoaded', function () {
    let lastChecked = null;
    document.querySelectorAll('input[type="checkbox"]').forEach(function (checkbox) {
      checkbox.addEventListener('click', function (e) {
        const name = checkbox.className;
        if (e.shiftKey && lastChecked && this !== lastChecked && this.className === lastChecked.className) {
          const checkboxes = Array.from(document.querySelectorAll('input.' + name));
          const start = checkboxes.indexOf(lastChecked);
          const end = checkboxes.indexOf(this);
          const [min, max] = [Math.min(start, end), Math.max(start, end)];
          for (let i = min; i <= max; i++) {
            checkboxes[i].checked = lastChecked.checked;
          }
        }
        lastChecked = this;
      });
    });
  });
</script>
{% endblock %}
